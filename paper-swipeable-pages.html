<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-swipeable-pages/iron-swipeable-pages.html">
<link rel="import" href="../dom-repeat-n/dom-repeat-n.html">

<!--
`<paper-swipeable-pages>` manages a set of pages and and provides the ability to switch
between them by swiping gesture.

Example:

    <paper-swipeable-pages>
      <div>One</div>
      <div>Two</div>
      <div>Three</div>
    </paper-swipeable-pages>

Additionnally, you can specify the following properties regarding the sensitivity of the swipe,
the transition used, and the possibility of cycling. For more details, see below.

It could be a good idea to disable text selection on any of the children that you
want to be swiped:

    .swipe {
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-user-select: none;
      user-select: none;
      cursor: default;
    }

TODO PG: defined custom properties and mixins

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="paper-swipeable-pages">
  <style>
    :host {
      display: block;
    }
    #page_selector {
      position: fixed;
      width: 100%;
      bottom: 10vh;
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
    }
    .page-selection {
      opacity: 0.35;
      fill: white;
      margin: 5vw;
      @apply(--psp-selection-fill);
      -webkit-transition: opacity 3s;
      transition: opacity 3s;
    }
    .page-selection[selected] {
      opacity: 1;
      @apply(--psp-selection-fill-selected);
    }
  </style>

  <template>
    <iron-swipeable-pages id="isp" selected="{{_selected}}" no-cycle>
      <content></content>
    </iron-swipeable-pages>
    <div id="page_selector">
      <template is="dom-repeat-n" count="[[_pageCount]]">
        <svg class="page-selection" selected$="{{_computeSelected(_selected, index)}}"
             width="30" height="30">
          <circle cx="15" cy="15" r="15"/>
        </svg>
      </template>
    </div>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'paper-swipeable-pages',

        properties: {
          _selected: {
            type: Number,
            value: 0,
          },
          _pageCount: {
            type: Number,
            value: 0,
          },
        },

        listeners: {
          'track': '_onTrack'
        },

        // Element Lifecycle
        attached: function() {
          this._pageCount = this.$.isp.items.length;
        },

        // Element behavior
        _onTrack: function(event) {
          var track = event.detail;

          if (track.state === 'start') {
            var pageSelections = Polymer.dom(this.$.page_selector).children;
            pageSelections.forEach(function(pageSelection, index) {
              if (this._selected == index) {
                pageSelection.style.opacity = '1';
              } else {
                pageSelection.style.opacity = '0.35';
              }
            }, this);
          }
        },

        _computeSelected: function(selected, index) {
          this.debounce("selectionDone", function() {
            var pageSelections = Polymer.dom(this.$.page_selector).children;
            pageSelections.forEach(function(pageSelection) {
              pageSelection.style.opacity = '0';
            });
          }, 2000);
          return selected == index;
        }
      });
    }());
  </script>
</dom-module>
